rtabmap:
  ros__parameters:
    # ── Core SLAM parameters ──────────────────────────────────
    Rtabmap/DetectionRate: "1"
    Rtabmap/TimeThr: "700"
    Rtabmap/MemoryThr: "0"
    Rtabmap/LoopThr: "0.11"

    # ── Memory ────────────────────────────────────────────────
    Mem/IncrementalMemory: "true"
    Mem/InitWMWithAllNodes: "false"
    Mem/STMSize: "30"
    Mem/UseOdomGravity: "true"

    # ── Odometry ─────────────────────────────────────────────
    Odom/Strategy: "0"
    Odom/ResetCountdown: "1"
    OdomF2M/MaxSize: "10000"

    # ── ICP LiDAR Odometry ───────────────────────────────────
    Icp/MaxCorrespondenceDistance: "0.1"
    Icp/PointToPlane: "true"
    Icp/Iterations: "30"
    Icp/VoxelSize: "0.2"
    Icp/MaxTranslation: "2.0"
    Icp/CorrespondenceRatio: "0.01"

    # ── 3D Map ───────────────────────────────────────────────
    Grid/3D: "true"
    Grid/CellSize: "0.05"
    Grid/RangeMax: "50.0"
    Grid/RangeMin: "0.5"
    Grid/MaxGroundHeight: "0.1"
    Grid/MaxObstacleHeight: "2.0"
    Grid/ClusterRadius: "0.1"
    Grid/GroundIsObstacle: "false"

    # ── LiDAR ────────────────────────────────────────────────
    subscribe_scan_cloud: true
    subscribe_scan: false

    # ── RGB-D (ZED X) ─────────────────────────────────────────
    subscribe_rgb: true
    subscribe_depth: true
    approx_sync: true
    approx_sync_max_interval: 0.05    # increased for ZED X latency

    # ── IMU ──────────────────────────────────────────────────
    subscribe_imu: true
    imu_tf_prefix: "imu_link"

    # ── Visual features ───────────────────────────────────────
    Vis/MaxFeatures: "600"
    Vis/MinInliers: "15"
    Vis/InlierDistance: "0.1"
    SURF/HessianThreshold: "300"

    # ── Loop Closure ──────────────────────────────────────────
    RGBD/LoopClosureIdentityGuess: "true"
    RGBD/LinearUpdate: "0.1"
    RGBD/AngularUpdate: "0.05"
    RGBD/NewMapOdomChangeDistance: "0"
    RGBD/OptimizeFromGraphEnd: "false"
    RGBD/OptimizeMaxError: "3.0"

    # ── Graph optimization ────────────────────────────────────
    Optimizer/Strategy: "1"
    Optimizer/Iterations: "100"
    Optimizer/Epsilon: "0.00001"
    Optimizer/Robust: "true"

    # ── Point cloud filtering (ZED X range: 0.3-20m) ──────────
    cloud_voxel_size: 0.05
    cloud_output_voxelized: true
    cloud_max_depth: 20.0             # ZED X max reliable depth
    cloud_min_depth: 0.3              # ZED X min depth